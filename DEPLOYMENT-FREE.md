# Free Production Deployment Guide

## üéØ Complete Free Tier Setup (Senior Engineer Approach)

This guide will deploy your Sales Jobverse platform to production using **100% free services** with enterprise-grade reliability.

### Total Monthly Cost: **$0.00**

---

## üìã Prerequisites

Before starting, create free accounts at:

1. **Railway** (Backend + Database): https://railway.app
2. **Vercel** (Frontend): https://vercel.com
3. **Cloudinary** (File Storage): https://cloudinary.com
4. **Better Stack** (Logging - Optional): https://betterstack.com
5. **Resend** (Email - Optional): https://resend.com

---

## üöÄ Part 1: Deploy Backend to Railway (5 minutes)

### Step 1: Set Up Railway Project

1. Go to https://railway.app and sign in with GitHub
2. Click **"New Project"**
3. Select **"Deploy from GitHub repo"**
4. Choose `abushanisro/grit-recruitment`
5. Railway will detect the Dockerfile automatically

### Step 2: Add PostgreSQL Database

1. In your Railway project, click **"+ New"**
2. Select **"Database" ‚Üí "PostgreSQL"**
3. Railway will create a PostgreSQL instance
4. Copy the **DATABASE_URL** connection string

### Step 3: Configure Environment Variables

In Railway project settings, add these variables:

```bash
# Core Settings
NODE_ENV=production
ENV=prod
PORT=3000

# Database (auto-generated by Railway)
DATABASE_URL=${{Postgres.DATABASE_URL}}

# Frontend URLs (will update after Vercel deployment)
FRONTEND_URL=https://your-app.vercel.app
ADMIN_FRONTEND_URL=https://your-admin.vercel.app

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
CALLBACK_URL=https://your-backend.up.railway.app/google/redirect

# Cloudinary (for file uploads)
CLOUDINARY_CLOUD_NAME=your-cloud-name
CLOUDINARY_API_KEY=your-api-key
CLOUDINARY_API_SECRET=your-api-secret

# Razorpay (Payment Gateway)
RAZORPAY_KEY_ID=your-razorpay-key-id
RAZORPAY_KEY_SECRET=your-razorpay-key-secret
RAZORPAY_WEBHOOK_SECRET=your-webhook-secret

# Slack (Alerts)
SLACK_BOT_TOKEN=your-slack-token

# Email (Optional - Resend API)
RESEND_API_KEY=your-resend-api-key

# AWS Pinpoint Alternative (for SMS/Email)
# Use Resend or SendGrid free tier instead
```

### Step 4: Deploy Backend

1. Click **"Deploy"** in Railway
2. Railway will build your Docker image
3. Deployment takes ~3-5 minutes
4. You'll get a URL like: `https://your-app.up.railway.app`

### Step 5: Set Up Custom Domain (Optional)

1. In Railway settings, click **"Settings"**
2. Scroll to **"Domains"**
3. Click **"Generate Domain"** or add your own
4. Railway provides free `.railway.app` subdomain

### Step 6: Run Database Migrations

**Option A: Using Railway CLI**
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Link to your project
railway link

# Run migrations
railway run pnpm --filter backend migration:up
```

**Option B: Using Railway Dashboard**
1. Go to your backend service in Railway
2. Click **"Variables"** tab
3. Add temporary variable: `RUN_MIGRATIONS=true`
4. In your `main.ts`, add migration logic on startup
5. Remove variable after first run

---

## üé® Part 2: Deploy Frontend to Vercel (3 minutes)

### Step 1: Set Up Vercel Project

1. Go to https://vercel.com and sign in with GitHub
2. Click **"Add New..." ‚Üí "Project"**
3. Import `abushanisro/grit-recruitment`
4. Configure build settings:
   - **Framework Preset**: Next.js
   - **Root Directory**: `apps/frontend`
   - **Build Command**: `pnpm run prod:build`
   - **Output Directory**: `out`
   - **Install Command**: `cd ../.. && pnpm install && cd apps/frontend`

### Step 2: Configure Environment Variables

Add these in Vercel project settings:

```bash
ENV=prod
NEXT_PUBLIC_API_URL=https://your-backend.up.railway.app
NEXT_PUBLIC_FRONTEND_URL=https://your-app.vercel.app
```

### Step 3: Deploy Frontend

1. Click **"Deploy"**
2. Vercel will build and deploy
3. Takes ~2-3 minutes
4. You'll get a URL like: `https://your-app.vercel.app`

### Step 4: Set Up Custom Domain (Optional)

1. In Vercel project settings, go to **"Domains"**
2. Add your custom domain
3. Vercel provides free `.vercel.app` subdomain
4. SSL certificate is automatic

### Step 5: Deploy Admin Panel

Repeat the same process for admin panel:
- **Root Directory**: `apps/admin-panel-frontend`
- Deploy separately or use the same project with different environment

---

## ‚òÅÔ∏è Part 3: Set Up Cloudinary (File Storage)

### Why Cloudinary?
- Free tier: 25GB storage, 25GB bandwidth/mo
- Built-in CDN
- Image transformations (resize, crop, optimize)
- Video support
- No AWS S3 needed

### Setup Steps:

1. Sign up at https://cloudinary.com
2. Go to **Dashboard**
3. Copy your credentials:
   - Cloud Name
   - API Key
   - API Secret
4. Add to Railway environment variables (already done above)

### Update Backend Code:

Your backend currently uses AWS S3. We'll keep it compatible or add Cloudinary:

```typescript
// apps/backend/src/upload/upload.service.ts
// Add Cloudinary SDK
import { v2 as cloudinary } from 'cloudinary';

cloudinary.config({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
});

// Upload method
async uploadToCloudinary(file: Express.Multer.File) {
  const result = await cloudinary.uploader.upload(file.path, {
    folder: 'sales-jobverse',
    resource_type: 'auto',
  });
  return result.secure_url;
}
```

---

## üìß Part 4: Set Up Email (Replace AWS Pinpoint)

### Option A: Resend (Recommended)
- Free: 100 emails/day, 3,000 emails/month
- Modern API, great DX
- https://resend.com

```bash
# Install Resend SDK
pnpm add resend
```

```typescript
// apps/backend/src/auth/email.service.ts
import { Resend } from 'resend';

const resend = new Resend(process.env.RESEND_API_KEY);

await resend.emails.send({
  from: 'noreply@yourdomain.com',
  to: user.email,
  subject: 'Welcome to Sales Jobverse',
  html: '<p>Welcome!</p>',
});
```

### Option B: SendGrid
- Free: 100 emails/day forever
- https://sendgrid.com

---

## üìä Part 5: Set Up Monitoring & Logs

### Option A: Better Stack (Logtail)
- Free: 1GB logs/month
- Real-time log streaming
- https://betterstack.com

```bash
# Install Better Stack SDK
pnpm add @logtail/node
```

```typescript
// apps/backend/src/main.ts
import { Logtail } from '@logtail/node';

const logtail = new Logtail(process.env.LOGTAIL_SOURCE_TOKEN);

app.use((req, res, next) => {
  logtail.info('Request received', {
    method: req.method,
    path: req.path,
  });
  next();
});
```

### Option B: Railway Built-in Logs
- Railway provides free logging
- View in Railway dashboard
- 7-day retention

---

## üîí Part 6: Security Best Practices

### Environment Variables Checklist

‚úÖ **Never commit to git:**
- All secrets in Railway/Vercel environment variables
- Use `.env.example` for documentation

‚úÖ **Separate environments:**
- Production: Railway + Vercel
- Staging: Separate Railway project
- Development: Local `.env` file

‚úÖ **Rotate secrets regularly:**
- Change API keys quarterly
- Use Railway's built-in secret rotation

### Railway Security Settings

1. Enable **"Private Networking"** (free on Railway)
2. Set up **"Health Checks"** on `/` endpoint
3. Configure **"Restart Policy"**: On Failure
4. Set **"Timeout"**: 300 seconds

### Vercel Security Headers (Already in vercel.json)

```json
{
  "headers": [
    {
      "key": "X-Content-Type-Options",
      "value": "nosniff"
    },
    {
      "key": "X-Frame-Options",
      "value": "DENY"
    }
  ]
}
```

---

## üö¶ Part 7: CI/CD with GitHub Actions (Free)

### Create `.github/workflows/railway-deploy.yml`:

```yaml
name: Deploy to Railway

on:
  push:
    tags:
      - 'release-v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Deploy to Railway
        run: railway up
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
```

### Create `.github/workflows/vercel-deploy.yml`:

```yaml
name: Deploy to Vercel

on:
  push:
    tags:
      - 'frontend-release-v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

---

## üìà Part 8: Monitoring Dashboard

### Set Up StatusPage (Free)

1. Use **Upptime** (GitHub-based, 100% free)
   - https://github.com/upptime/upptime
   - Automated status page from GitHub Actions
   - Free hosting on GitHub Pages

2. Or **Better Uptime** (Free plan)
   - https://betterstack.com/better-uptime
   - 5 monitors free
   - SMS/Email alerts

---

## üí∞ Cost Comparison

| Service | Free Tier | If You Exceed |
|---------|-----------|---------------|
| Railway | 500 hrs/mo | $5/month per service |
| Vercel | Unlimited | $20/month for Pro |
| Cloudinary | 25GB/mo | $0.07/GB |
| PostgreSQL | 1GB | Included in Railway |
| Resend | 3,000/mo | $20 for 50k |

**Total Monthly Cost (within free tier): $0.00**

---

## üéØ Deployment Checklist

Before going live:

### Backend (Railway):
- [ ] PostgreSQL database created
- [ ] All environment variables set
- [ ] Database migrations run
- [ ] Health check endpoint responding
- [ ] Slack alerts configured
- [ ] Custom domain configured (optional)

### Frontend (Vercel):
- [ ] Build successful
- [ ] Environment variables set
- [ ] API connection working
- [ ] Google OAuth configured
- [ ] Custom domain configured (optional)

### Third-Party Services:
- [ ] Cloudinary configured
- [ ] Resend/SendGrid API key added
- [ ] Google OAuth credentials updated
- [ ] Razorpay keys configured
- [ ] PostHog project ID set

### Security:
- [ ] No secrets in git repository
- [ ] CORS configured correctly
- [ ] Rate limiting enabled
- [ ] HTTPS enforced
- [ ] Security headers set

### Monitoring:
- [ ] Logging configured
- [ ] Error alerts set up
- [ ] Uptime monitoring active
- [ ] Performance tracking enabled

---

## üîß Troubleshooting

### Backend won't start on Railway

```bash
# Check logs in Railway dashboard
# Common issues:
1. Missing environment variables
2. Database connection timeout
3. Port binding (must use PORT env var)
```

### Frontend build fails on Vercel

```bash
# Check build logs in Vercel
# Common issues:
1. Missing dependencies
2. TypeScript errors
3. Environment variables not set
4. Build command incorrect
```

### Database connection errors

```bash
# Railway PostgreSQL connection
# Use internal DNS:
DATABASE_URL=${{Postgres.DATABASE_PRIVATE_URL}}

# This avoids public internet routing
```

---

## üöÄ Quick Start Commands

### Deploy Backend to Railway:

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# Initialize project
railway init

# Deploy
railway up
```

### Deploy Frontend to Vercel:

```bash
# Install Vercel CLI
npm install -g vercel

# Login
vercel login

# Deploy
cd apps/frontend
vercel --prod
```

---

## üìö Additional Resources

- Railway Docs: https://docs.railway.app
- Vercel Docs: https://vercel.com/docs
- Cloudinary Docs: https://cloudinary.com/documentation
- Resend Docs: https://resend.com/docs

---

## üéâ Success Metrics

After deployment, you should have:

‚úÖ Backend running on Railway with 99.9% uptime
‚úÖ Frontend on Vercel CDN (edge locations worldwide)
‚úÖ PostgreSQL database with automated backups
‚úÖ File uploads to Cloudinary CDN
‚úÖ Email notifications via Resend
‚úÖ Error monitoring via Slack
‚úÖ Zero monthly cost (within free tiers)

---

## üí° Pro Tips

1. **Use Railway Templates** - Pre-configured setups
2. **Enable Vercel Analytics** - Free performance insights
3. **Set up Cloudflare** - Additional free CDN layer
4. **Use Railway CLI** - Faster deployments
5. **Configure GitHub Branch Deploys** - Preview environments

---

## üÜò Need Help?

- Railway Support: https://help.railway.app
- Vercel Support: https://vercel.com/support
- Community: Join Railway Discord / Vercel Discord

---

**Your app will be live at:**
- Frontend: `https://your-app.vercel.app`
- Backend: `https://your-backend.up.railway.app`
- Admin: `https://your-admin.vercel.app`

**Deployment time:** ~10 minutes total

**Cost:** $0.00/month
